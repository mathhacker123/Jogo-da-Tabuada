import tkinter as tk
from tkinter import messagebox
import random
import mysql.connector

# Conectar ao banco de dados MySQL
conn = mysql.connector.connect(
    host="localhost",
    user="root",
    password="",
    database="tabuada"
)
cursor = conn.cursor()

# Criar tabela de ranking se não existir
cursor.execute("""
CREATE TABLE IF NOT EXISTS ranking (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(255),
    pontuacao INT
)
""")

# Função para gerar uma nova pergunta
def generate_question():
    num1 = random.randint(1, 10)
    num2 = random.randint(1, 10)
    return f"Quanto é {num1} x {num2} ?", num1 * num2

# Função para registrar o placar no banco de dados
def register_score(name, score):
    cursor.execute("INSERT INTO ranking (nome, pontuacao) VALUES (%s, %s)", (name, score))
    conn.commit()

# Função para verificar a resposta
def check_answer():
    global question, answer, score, question_count
    user_input = entry.get()
    if user_input:
        try:
            user_answer = int(user_input)
            if user_answer == answer:
                score += 1
            question_count += 1
            if question_count < 5:
                question, answer = generate_question()
                label.config(text=question)
                entry.delete(0, tk.END)
            else:
                name = entry_name.get()
                register_score(name, score)
                messagebox.showinfo("Fim do Jogo", f"Seu placar final é: {score}")
                root.destroy()
        except ValueError:
            messagebox.showerror("Erro", "Por favor, insira um número válido.")
    else:
        messagebox.showerror("Erro", "Por favor, insira uma resposta.")

# Criar a janela principal
root = tk.Tk()
root.title("Jogo de Tabuada")

# Variáveis globais
question_count = 0
score = 0
question, answer = generate_question()

# Widgets
label = tk.Label(root, text=question, font=("Helvetica", 18))
label.pack(pady=20)

entry = tk.Entry(root, font=("Helvetica", 18))
entry.pack(pady=10)

label_name = tk.Label(root, text="Seu nome:", font=("Helvetica", 14))
label_name.pack()

entry_name = tk.Entry(root, font=("Helvetica", 14))
entry_name.pack(pady=5)

button = tk.Button(root, text="Enviar", command=check_answer, font=("Helvetica", 14))
button.pack(pady=10)

# Executar a aplicação
root.mainloop()
